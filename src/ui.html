<!-- https://github.com/thomas-lowry/figma-plugin-ds -->
<!-- https://forum.figma.com/t/linking-css-to-ui-html/5347 -->
<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <title>Applitools Figma Plugin</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/thomas-lowry/figma-plugin-ds@master/dist/figma-plugin-ds.css">
    </head>

    <body class="m-small" style="border: solid 5px #00a096;margin: 0px; padding: 10px">

        <div class="onboarding-tip" style="justify-content: center">
            <div class="icon icon--effects"></div>
            <div class="onboarding-tip__msg">Figma Plugin for Applitools</div>
        </div>
       
        <div class="input">
            Enter API Key: <input type="input" id="key" class="input__field" placeholder="Your Applitools API Key 'Required'" style="width: 100%">
        </div>
        
        <div class="input">
            Enter Server URL: <input type="input" id="url" class="input__field" placeholder="Default: https://eyesapi.applitools.com" style="width: 100%">
        </div>
        <div class="input">
            <a href="#" id="advanced"><span id="hideShow">Show</span> Advanced</a>
        </div>
        <div>&nbsp;</div>
        <div id="advanced-section" style="display:none" style="width: 100%">
            <div class="input">
                Override OS (experimental): <input type="input" id="os" class="input__field" placeholder="Linux" style="width: 50%">
            </div>

            <div class="input">
                Override Browser (experimental): <input type="input" id="browser" class="input__field" placeholder="Chrome 106.0" style="width: 50%">
            </div>

            <div class="input">
                Enter Proxy URL: <input type="input" id="proxy" class="input__field" placeholder="Your Proxy URL 'Optional'" style="width: 100%">
            </div>

            <label for="matchLevel">Select Match Level:</label>
            <select id="matchLevel" class="select-menu">
                <option value="Strict" >Strict</option>
                <option value="Content" >Content</option>
                <option value="Layout" >Layout</option>
                <option value="Exact" >Exact</option>
            </select>

            <label for="contrastLevel">Select Contrast Level:</label>
            <select id="contrastLevel" class="select-menu">
                <option value="AA 2_0" >AA 2_0</option>
                <option value="AA 2_1" >AA 2_1</option>
                <option value="AAA 2_0" >AAA 2_0</option>
                <option value="AAA 2_1" >AAA 2_1</option>
            </select>

            <label for="switches">Options:</label>
            <ul id="switches" style="list-style: none; display: flex; margin: auto">
                
                <div class="switch">
                    <input class="switch__toggle" type="checkbox" id="everything">
                    <label class="switch__label" for="everything">Include Components</label>
                </div>
                
                <div class="switch">
                    <input class="switch__toggle" type="checkbox" id="saveFailedTests">
                    <label class="switch__label" for="saveFailedTests">Auto Accept unresolved/failed</label>
                </div>
            </ul>
        </div>
        <ul style="list-style: none; display: flex; align-items: center; justify-content: center">
            <li style="margin: auto"><button id="save" class='button button--primary'>Export</button></li>
            <li style="margin: auto"><button id="cancel" class='button button--primary-destructive'>Cancel</button></li>
        </ul>
        
        <div id="results-section" style="display:none;padding-top: 10px;">
            <label for="results-url">Results:</label>
            <a id="results-url" class="type--small" href="" target="_blank"></a>
        </div>

        <div id="baseline-list-section" style="display:none;padding-top: 10px;">
            For implemention to design comparison, please share the details below with your developer(s):
            <ul id="baseline-list" style="list-style-type:none;font-size: 12px;padding-left: 10px">
            </ul>
        </div>
          

        <textarea rows=17 class="textarea" id="console" style="border: solid 2px rgb(0, 0, 0); width: 100%; max-width: 100%; resize: none; overflow-y: scroll;;padding-top: 10px" disabled></textarea>
        
        <script src="https://cdn.jsdelivr.net/gh/thomas-lowry/figma-plugin-ds/dist/iife/figma-plugin-ds.js"></script>
        <script>

            (function() {
                var cors_api_host = 'infinite-dawn-90208.herokuapp.com';
                var cors_api_url = 'https://' + cors_api_host + '/';
                var slice = [].slice;
                var origin = window.location.protocol + '//' + window.location.host;
                var open = XMLHttpRequest.prototype.open;
                XMLHttpRequest.prototype.open = function() {
                    var args = slice.call(arguments);
                    var targetOrigin = /^https?:\/\/([^\/]+)/i.exec(args[1]);
                    if (targetOrigin && targetOrigin[0].toLowerCase() !== origin &&
                        targetOrigin[1] !== cors_api_host) {
                        args[1] = cors_api_url + args[1];
                    }
                    return open.apply(this, args);
                };
            })();

            (function () {
                if (!console) {
                    console = {};
                }
                var old = console.log;
                var logger = document.getElementById('console');
                console.log = function (message) {
                    if (typeof message == 'object') {
                        logger.innerHTML += (JSON && JSON.stringify ? JSON.stringify(message) : String(message) + '\n');
                    } else {
                        logger.innerHTML += message + '\n';
                    }
                }
            })();

            (function () {
                if (!baselineEnvConsole) {
                    baselineEnvConsole = {};
                }
                var old = baselineEnvConsole.log;
                var logger = document.getElementById('baselineEnvConsole');
                baselineEnvConsole.log = function (message) {
                    if (typeof message == 'object') {
                        logger.innerHTML += (JSON && JSON.stringify ? JSON.stringify(message) : String(message) + '\n');
                    } else {
                        logger.innerHTML += message + '\n';
                    }
                }
            })();

            //initialize all select menus
            selectMenu.init();
            //uninitialize all select menus
            //selectMenu.destroy('matchLevel');
            
            // Have console scroll to bottom if we add more print output...
            // var textarea = document.getElementById('console');
            // textarea.scrollTop = textarea.scrollHeight;

            // Add spinner logic later..
            // function spinner() {
            //     document.getElementsByClassName("icon icon--spinner icon--spin")[0].style.display = "block";
            // }

        </script>
    </body>
</html>